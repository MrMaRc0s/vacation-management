<!DOCTYPE html>
<html>
<head><title>Employee Dashboard</title></head>
<body>
  <h2>Employee Dashboard</h2>
  <form id="requestForm">
    <input name="start_date" type="date" required />
    <input name="end_date" type="date" required />
    <input name="reason" placeholder="Reason" required />
    <button type="submit">Submit Vacation</button>
  </form>

  <div id="requests"></div>

  <script>
    const user = JSON.parse(sessionStorage.getItem("user"));

    document.getElementById('requestForm').onsubmit = async (e) => {
      e.preventDefault();
      const res = await fetch('/requests', {
        method: 'POST',
        body: JSON.stringify({
          user_id: user.userId,
          start_date: e.target.start_date.value,
          end_date: e.target.end_date.value,
          reason: e.target.reason.value
        })
      });
      alert(await res.text());
      location.reload();
    };

    fetch('/requests/view', {
      method: 'POST',
      body: JSON.stringify({ user_id: user.userId, role: "employee" })
    })
      .then(res => res.json())
      .then(data => {
        document.getElementById('requests').innerHTML = `<h3>Your Requests</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
      });
  </script>
</body>
</html>
